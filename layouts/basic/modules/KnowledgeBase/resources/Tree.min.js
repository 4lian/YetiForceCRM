
jQuery.Class("KnowledgeBase_Tree_Js",{},{treeInstance:false,generateTree:function(b,e){var d=this;d.treeInstance=b.find("#treeContent");var c=e.result;var a=["search"];d.treeInstance.jstree({core:{data:c,themes:{name:"proton",responsive:true}},plugins:a})},loadTree:function(c){var b=this;var a=$(".treeContainer");var e={module:app.getModuleName(),action:"TreeAJAX",};var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});if(c){b.treeInstance.jstree("destroy")}AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});b.generateTree(a,f);b.registerTreeEvents(a)})},searchingInTree:function(a){this.treeInstance.jstree(true).search(a)},registerSearchEvent:function(){var c=this;var a=$("#valueSearchTree");var b=$("#btnSearchTree");a.keypress(function(d){if(d.which==13){c.searchingInTree(a.val())}});b.click(function(){c.searchingInTree(a.val())})},registerTreeEvents:function(){var a=this;a.registerSearchEvent();a.treeInstance.on("changed.jstree",function(h,g){if(g.node.original.type=="folder"){var d=Vtiger_Header_Js.getInstance();var c=app.getModuleName();var f=function(e){a.loadTree(true)};var b={category:g.node.original.record_id};var i={callbackFunction:f,data:b,noCache:true};d.quickCreateModule(c,i)}else{}})},registerEvents:function(){var a=this;a.loadTree(false)}});