
jQuery.Class("KnowledgeBase_Tree_Js",{},{treeInstance:false,content:false,getContent:function(){if(!this.content){this.content=$(".contentOfData")}return this.content},generateTree:function(b,e){var d=this;d.treeInstance=b.find("#treeContent");var c=e.result;var a=["search"];d.treeInstance.jstree({core:{data:c,themes:{name:"proton",responsive:true}},plugins:a})},loadTree:function(c){var b=this;var a=$(".treeContainer");var e={module:app.getModuleName(),action:"TreeAJAX",};var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});if(c){b.treeInstance.jstree("destroy")}AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});b.generateTree(a,f);b.registerTreeEvents(a)})},searchingInTree:function(a){this.treeInstance.jstree(true).search(a)},registerSearchEvent:function(){var c=this;var a=$("#valueSearchTree");var b=$("#btnSearchTree");a.keypress(function(d){if(d.which==13){c.searchingInTree(a.val())}});b.click(function(){c.searchingInTree(a.val())})},loadContent:function(b){var c=this;var a=c.getContent();var e={module:app.getModuleName(),view:"ContentAJAX",};if(typeof b!="undefined"){e.record=b}var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});a.html(f)})},registerTreeEvents:function(){var a=this;a.registerSearchEvent();a.treeInstance.on("changed.jstree",function(c,b){if(b.node.original.type!="folder"){a.loadContent(b.node.original.record_id)}})},registerBasicEvents:function(){var a=this;$(".addRecord").click(function(){var c=Vtiger_Header_Js.getInstance();var b=app.getModuleName();var d=function(f){a.loadTree(true)};var e={callbackFunction:d,noCache:false};c.quickCreateModule(b,e)})},registerEvents:function(){var a=this;a.registerBasicEvents();a.loadTree(false);a.loadContent()}});