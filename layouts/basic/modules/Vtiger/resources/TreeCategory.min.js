
jQuery.Class("Vtiger_TreeCategory_Js",{},{modalContainer:false,treeInstance:false,treeData:false,getModalContainer:function(){if(this.modalContainer==false){this.modalContainer=jQuery("#globalmodal .modal-content")}return this.modalContainer},getRecords:function(b){if(this.treeData==false&&b!="undefined"){var a=b.find("#treePopupValues").val();this.treeData=JSON.parse(a)}return this.treeData},generateTree:function(a){var b=this;if(b.treeInstance==false){b.treeInstance=a.find("#treePopupContents");b.treeInstance.jstree({core:{data:b.getRecords(),themes:{name:"proton",responsive:true}},plugins:["checkbox","search"]})}},searching:function(a){this.treeInstance.jstree(true).search(a)},registerSearchEvent:function(){var c=this;var a=$("#valueSearchTree");var b=$("#btnSearchTree");a.keypress(function(d){if(d.which==13){c.searching(a.val())}});b.click(function(){c.searching(a.val())})},registerSaveRecords:function(b){var f=this;var a=[];var e=[];var c=[];var d=[];$.each(f.getRecords(),function(g,h){if(h.state.selected){a.push(h.record_id)}});b.find('[name="saveButton"]').on("click",function(g){$.each(f.treeInstance.jstree("get_selected",true),function(h,i){if(jQuery.inArray(i.original.record_id,a)==-1){c.push(i.original.record_id)}e.push(i.original.record_id)});$.each(a,function(h,i){if(jQuery.inArray(i,e)==-1){d.push(i)}});AppConnector.request({module:app.getModuleName(),action:"RelationAjax",mode:"updateRelation",toAdd:c,toRemove:d,}).then(function(h){console.log(h);app.hideModalWindow()})})},registerEvents:function(){var a=this.getModalContainer();this.getRecords(a);this.generateTree(a);this.registerSaveRecords(a);this.registerSearchEvent()}});jQuery(function(){var a=new Vtiger_TreeCategory_Js();a.registerEvents()});