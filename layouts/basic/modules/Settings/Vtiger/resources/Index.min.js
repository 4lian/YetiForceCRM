
jQuery.Class("Settings_Vtiger_Index_Js",{showMessage:function(a){var b={};b.animation="show";b.type="success";b.title=app.vtranslate("JS_MESSAGE");if(typeof a!="undefined"){var b=jQuery.extend(b,a)}Vtiger_Helper_Js.showPnotify(b)}},{registerDeleteShortCutEvent:function(b){var a=this;if(typeof b=="undefined"){var b=jQuery("div#settingsShortCutsContainer")}b.on("click",".unpin",function(h){var j=jQuery(h.currentTarget);var i=j.closest(".moduleBlock");var c=j.data("id");var g=i.data("actionurl");var d=g+"&pin=false";var f=jQuery.progressIndicator({blockInfo:{enabled:true}});AppConnector.request(d).then(function(l){if(l.result.SUCCESS=="OK"){i.remove();a.registerSettingShortCutAlignmentEvent();var m="#"+c+"_menuItem";var k=jQuery(m);var e=k.data("pinimageurl");k.attr("src",e).data("action","pin");f.progressIndicator({mode:"hide"});var n={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SUCCESSFULLY_UNPINNED"),animation:"show",type:"info"};a.registerReAlign();Vtiger_Helper_Js.showPnotify(n)}});h.stopPropagation()})},registerPinUnpinShortCutEvent:function(){var b=this;var a=jQuery("div.widgetContainer");a.on("click",".pinUnpinShortCut",function(i){var g=jQuery(i.currentTarget);var d=g.closest(".menuItem").data("actionurl");var c=g.data("action");if(c=="pin"){var f=d+"&pin=true"}else{f=d+"&pin=false"}var h=jQuery.progressIndicator({blockInfo:{enabled:true}});AppConnector.request(f).then(function(l){if(l.result.SUCCESS=="OK"){if(c=="pin"){var e=g.data("unpinimageurl");var j=g.data("unpintitle");g.attr("src",e).data("action","unpin").attr("title",j);var m={fieldid:g.data("id"),mode:"getSettingsShortCutBlock",module:"Vtiger",parent:"Settings",view:"IndexAjax"};AppConnector.request(m).then(function(q){var n=jQuery("#settingsShortCutsContainer");var p=jQuery("#settingsShortCutsContainer div.row:last");var o=jQuery("#settingsShortCutsContainer div.row:last").children("div").length;if(o==3){var s=jQuery("#settingsShortCutsContainer").append('<div class="row">'+q)}else{var s=jQuery(q).appendTo(p)}b.registerSettingShortCutAlignmentEvent();h.progressIndicator({mode:"hide"});var r={text:app.vtranslate("JS_SUCCESSFULLY_PINNED")};Settings_Vtiger_Index_Js.showMessage(r)})}else{var e=g.data("pinimageurl");var k=g.data("pintitle");g.attr("src",e).data("action","pin").attr("title",k);jQuery("#shortcut_"+g.data("id")).remove();b.registerSettingShortCutAlignmentEvent();h.progressIndicator({mode:"hide"});var m={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SUCCESSFULLY_UNPINNED"),animation:"show",type:"info"};b.registerReAlign();Vtiger_Helper_Js.showPnotify(m)}}})})},registerSettingsShortcutClickEvent:function(){jQuery("#settingsShortCutsContainer").on("click",".moduleBlock",function(b){var a=jQuery(b.currentTarget).data("url");window.location.href=a})},registerSettingShortCutAlignmentEvent:function(){jQuery("#settingsShortCutsContainer").find(".moduleBlock").removeClass("marginLeftZero");jQuery("#settingsShortCutsContainer").find(".moduleBlock:nth-child(3n+1)").addClass("marginLeftZero")},registerWidgetsEvents:function(){var a=jQuery("div.widgetContainer");a.on("shown.bs.collapse",function(g){var c=jQuery(g.currentTarget);var f=c.closest(".quickWidget").find(".quickWidgetHeader");var d=f.find(".imageElement");var b=d.data("downimage");d.attr("src",b)});a.on("hidden.bs.collapse",function(g){var c=jQuery(g.currentTarget);var f=c.closest(".quickWidget").find(".quickWidgetHeader");var d=f.find(".imageElement");var b=d.data("rightimage");d.attr("src",b)})},registerAddShortcutDragDropEvent:function(){var a=this;jQuery(".menuItemLabel").draggable({appendTo:"body",helper:"clone"});jQuery("#settingsShortCutsContainer").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".menuItemLabel",drop:function(b,e){var d=e.draggable.closest(".menuItem").find(".pinUnpinShortCut");var c=d.data("action");if(c=="unpin"){var f={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SHORTCUT_ALREADY_ADDED"),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(f)}else{e.draggable.closest(".menuItem").find(".pinUnpinShortCut").trigger("click");a.registerSettingShortCutAlignmentEvent()}}})},registerReAlign:function(){var a={mode:"realignSettingsShortCutBlock",module:"Vtiger",parent:"Settings",view:"IndexAjax"};AppConnector.request(a).then(function(b){jQuery("#settingsShortCutsContainer").html(b)})},loadCkEditorElement:function(){var a={};var c=jQuery(".ckEditorSource");var b=new Vtiger_CkEditor_Js();b.loadCkEditor(c,a)},registerSaveIssues:function(){var c=jQuery("#titleIssues");var a=CKEDITOR.instances.bodyIssues;var b=this;jQuery(".saveIssues").click(function(){var d=jQuery.trim(a.document.getBody().getText());var e={module:"Github",parent:"Settings",action:"SaveIssuesAJAX",title:c.val(),body:d};AppConnector.request(e).then(function(f){b.reloadContent()})})},reloadContent:function(){jQuery(".massEditTabs li.active").trigger("click")},resisterSaveKeys:function(){var b=this;var a=jQuery(".authModalContent");jQuery(".saveKeys").click(function(){var c={module:"Github",parent:"Settings",action:"SaveKeysAJAX",client_id:$('[name="client_id"]').val(),token:$('[name="token"]').val()};a.progressIndicator({});AppConnector.request(c).then(function(d){a.progressIndicator({mode:"hide"});app.hideModalWindow();b.reloadContent()})})},registerTabEvents:function(){var a=this;jQuery(".massEditTabs li").on("click",function(){a.loadContent(jQuery(this).data("mode"))})},registerPagination:function(){var b=jQuery(".pagination .pageNumber");var a=this;b.click(function(){a.loadContent("Github",$(this).data("id"))})},registerAuthorizedEvent:function(){var a=this;jQuery(".showModal").on("click",function(){app.showModalWindow(jQuery(".authModal"),function(){a.resisterSaveKeys()})})},registerEventsForGithub:function(a){var b=this;b.registerAuthorizedEvent();b.registerSaveIssues();b.registerPagination();app.showBtnSwitch(a.find(".switchBtn"));a.find(".switchBtn").on("switchChange.bootstrapSwitch",function(d,c){if(c){b.loadContent("Github",1,"closed")}else{b.loadContent("Github",1,"open")}});$(".addIssuesBtn").on("click",function(){var c={module:"Github",parent:"Settings",view:"AddIssueAJAX"};a.progressIndicator({});AppConnector.request(c).then(function(d){a.progressIndicator({mode:"hide"});app.showModalWindow(d,function(){b.loadCkEditorElement()})})})},loadContent:function(f,d,c){var b=this;var a=jQuery(".indexContainer");var e={mode:f,module:app.getModuleName(),parent:"Settings",view:"Index",page:d,state:c};a.progressIndicator({});AppConnector.request(e).then(function(g){a.progressIndicator({mode:"hide"});a.html(g);b.registerEventsForGithub(a)})},registerEvents:function(){this.registerSettingsShortcutClickEvent();this.registerDeleteShortCutEvent();this.registerWidgetsEvents();this.registerPinUnpinShortCutEvent();this.registerAddShortcutDragDropEvent();this.registerSettingShortCutAlignmentEvent();this.registerTabEvents();this.reloadContent()}});