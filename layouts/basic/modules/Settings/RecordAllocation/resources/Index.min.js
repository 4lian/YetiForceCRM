
jQuery.Class("Settings_RecordAllocation_Index_Js",{},{container:false,registerDataTables:function(a){var b=this;$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}});if(a==undefined){a=b.getContainer()}var c=a.find(".dataTable").dataTable({scrollY:200,deferRender:true,scroller:true,paging:false,info:false})},registerDragDropEvent:function(a){var b=this;if(a==undefined){a=b.getContainer()}a.find(".panel").each(function(){var c=jQuery(this).data("index");jQuery(this).find(".dragDrop"+c).draggable({appendTo:"body",helper:"clone",start:function(g,f){var d=$(f.helper.context).width();$(f.helper).css("width",d).addClass("dataTableDragDrop bg-primary")},zIndex:9999999999});jQuery(this).find(".dataTables_scrollBody .dataTable").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".dragDrop"+c,drop:function(f,g){var e=$(g.draggable).closest(".dataTable");var d=$(this);if(e.data("mode")!=d.data("mode")){e.DataTable().row(g.draggable).remove().draw();d.DataTable().row.add(g.draggable[0]).draw();b.save()}}})})},save:function(){var b=[];var a=[];this.getContainer().find(".panel").each(function(){a.users=[];a.groups=[];var c=jQuery(this).data("module");var d=jQuery(this).find(".dataTables_scrollBody:first tbody tr");d.each(function(f){var h=jQuery(this).data("id");var g=jQuery(this).data("type");if(h&&g){a[g].push(h)}});b[c]=jQuery.extend({},a)});app.saveAjax("save",JSON.stringify(b))},registerModalButton:function(){var b=this;var a=this.getContainer();a.find("button.addPanel").on("click",function(){var d=a.find("#myModal").clone(true,true);var e=b.getModules();d.find("select option").each(function(){if(jQuery.inArray(jQuery(this).val(),e)!=-1){jQuery(this).remove()}});var c=function(h){var f=h.find("select");app.showSelect2ElementView(f);var g=h.find("form");g.submit(function(l){var k=jQuery(l.currentTarget);var j=k.find("#modulesList");if(j.length&&j.val()){b.addPanel(j.val()).then(function(m){if(m){b.save()}})}else{var i=app.vtranslate("JS_FIELD_EMPTY");j.prev("div").validationEngine("showPrompt",i,"error","bottomLeft",true);l.preventDefault();return}l.preventDefault()})};app.showModalWindow(d,function(f){if(typeof c=="function"){c(f)}})})},getModules:function(){var b=this;var a=[];this.getContainer().find(".panel").each(function(){a.push(jQuery(this).data("module"))});return a},addPanel:function(b){var c=this;var a=jQuery.Deferred();var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d=this.getContainer().find(".panel:last");var f={};f.index=d.data("index");f.module=app.getModuleName();f.parent=app.getParentModuleName();f.moduleId=b;f.view="Index";f.mode="getPanel";AppConnector.request(f).then(function(h){c.getContainer().find(".panelsContainer").append(h);var g=c.getContainer().find(".panelItem:last");c.registerDataTables(g);c.registerDragDropEvent(g);app.hideModalWindow();e.progressIndicator({mode:"hide"});a.resolve(h)},function(g){e.progressIndicator({mode:"hide"});a.reject(g)});return a.promise()},getContainer:function(){if(this.container==false){this.container=jQuery("div.contentsDiv")}return this.container},registerEvents:function(){this.registerDataTables();this.registerDragDropEvent();this.registerModalButton()}});