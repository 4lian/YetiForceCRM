
Settings_PDF_Edit_Js("Settings_PDF_Edit6_Js",{},{step6Container:false,advanceFilterInstance:false,init:function(){this.initialize()},getContainer:function(){return this.step6Container},setContainer:function(a){this.step6Container=a;return this},initialize:function(a){if(typeof a==="undefined"){a=jQuery("#pdf_step6")}if(a.is("#pdf_step6")){this.setContainer(a)}else{this.setContainer(jQuery("#pdf_step6"))}},calculateValues:function(){var b=jQuery("#enableAdvanceFilters");if(b.length>0&&b.is(":checked")==false){jQuery("#advanced_filter").val(jQuery("#olderConditions").val())}else{jQuery('[name="filtersavedinnew"]').val("6");var a=this.advanceFilterInstance.getValues();jQuery("#advanced_filter").val(JSON.stringify(a))}},submit:function(){var b=jQuery.Deferred();this.calculateValues();var c=this.getContainer();var e=c.serializeFormData();var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var a=c.serializeFormData();a.action="Save";a.step=6;a.view="";AppConnector.request(a).then(function(f){f=JSON.parse(f);if(f.success==true){Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_PDF_SAVED_SUCCESSFULLY")});AppConnector.request(e).then(function(g){c.hide();d.progressIndicator({mode:"hide"});b.resolve(g)},function(g,h){})}},function(f,g){app.errorLog(f,g)});return b.promise()},registerCancelStepClickEvent:function(a){jQuery("button.cancelLink",a).on("click",function(){window.history.back()})},getPopUp:function(a){var b=this;if(typeof a=="undefined"){a=b.getContainer()}a.on("click",".getPopupUi",function(j){var g=jQuery(j.currentTarget);var d=g.val();var q=g.closest(".fieldUiHolder");var h=q.find('[name="valuetype"]').val();if(h==""){h="rawtext"}var m=g.closest(".conditionsContainer");var c=g.closest(".conditionRow");var l=m.find(".popupUi").clone(true,true).removeClass("popupUi").addClass("clonedPopupUi");l.find("select").addClass("chzn-select");l.find(".fieldValue").val(d);if(g.hasClass("date")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var p=g.data("date-format");if(h=="rawtext"){var o=g.val()}else{o=""}var k='<input type="text" class="dateField fieldValue col-md-4" value="'+o+'" data-date-format="'+p+'" data-input="true" >';l.find(".fieldValueContainer").prepend(k)}else{if(g.hasClass("time")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");if(h=="rawtext"){var o=g.val()}else{o=""}var n='<input type="text" class="timepicker-default fieldValue col-md-4 form-control" value="'+o+'" data-input="true" >';l.find(".fieldValueContainer").prepend(n)}else{if(g.hasClass("boolean")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");if(h=="rawtext"){var o=g.val()}else{o=""}var i='<input type="checkbox" class="fieldValue col-md-4" value="'+o+'" data-input="true" >';l.find(".fieldValueContainer").prepend(i);var d=l.find(".fieldValueContainer input").val();if(o=="true:boolean"||o==""){l.find(".fieldValueContainer input").attr("checked","checked")}else{l.find(".fieldValueContainer input").removeAttr("checked")}}}}var f=function(r){r.find(".clonedPopupUi").removeClass("hide");var s=c.find('[name="modulename"]');if(s.length>0){var e=s.val();r.find(".useFieldElement").addClass("hide");r.find('[name="'+e+'"]').removeClass("hide")}app.changeSelectElementView(r);app.registerEventForDatePickerFields(r);app.registerEventForTimeFields(r);b.postShowModalAction(r,h);b.registerChangeFieldEvent(r);b.registerSelectOptionEvent(r);b.registerPopUpSaveEvent(r,q);b.registerRemoveModalEvent(r);r.find(".fieldValue").filter(":visible").trigger("focus");r.find('[data-close-modal="modal"]').off("click").on("click",function(){jQuery(this).closest(".modal").removeClass("in").css("display","none")})};m.find(".clonedPopUp").html(l);jQuery(".clonedPopupUi").on("shown.bs.modal",function(){if(typeof f=="function"){f(jQuery(".clonedPopupUi",m))}});jQuery(".clonedPopUp",m).find(".clonedPopupUi").modal()})},registerRemoveModalEvent:function(a){a.on("click",".closeModal",function(b){a.modal("hide")})},registerPopUpSaveEvent:function(b,a){jQuery('[name="saveButton"]',b).on("click",function(g){var h=jQuery(".textType",b).val();a.find('[name="valuetype"]').val(h);var d=a.find(".getPopupUi");if(h!="rawtext"){d.removeAttr("data-validation-engine");d.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")}else{d.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]");d.attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")}var c=b.find(".fieldValue").filter(":visible").attr("type");var f=b.find(".fieldValue").filter(":visible").val();if(c=="checkbox"){if(b.find(".fieldValue").filter(":visible").is(":checked")){f="true:boolean"}else{f="false:boolean"}}d.val(f);b.modal("hide");d.validationEngine("hide")})},postShowModalAction:function(b,c){if(c=="fieldname"){jQuery(".useFieldContainer",b).removeClass("hide");jQuery(".textType",b).val(c).trigger("chosen:updated")}else{if(c=="expression"){jQuery(".useFieldContainer",b).removeClass("hide");jQuery(".useFunctionContainer",b).removeClass("hide");jQuery(".textType",b).val(c).trigger("chosen:updated")}}jQuery("#"+c+"_help",b).removeClass("hide");var a=jQuery(".textType",b).find("option:selected").data("ui");jQuery(".fieldValue",b).hide();jQuery("[data-"+a+"]",b).show()},registerChangeFieldEvent:function(a){jQuery(".textType",a).on("change",function(f){var g=jQuery(f.currentTarget).val();var c=jQuery(".useFieldContainer",a);var d=jQuery(".useFunctionContainer",a);var b=jQuery(f.currentTarget).find("option:selected").data("ui");jQuery(".fieldValue",a).hide();jQuery("[data-"+b+"]",a).show();if(g=="fieldname"){c.removeClass("hide");d.addClass("hide")}else{if(g=="expression"){c.removeClass("hide");d.removeClass("hide")}else{c.addClass("hide");d.addClass("hide")}}jQuery(".helpmessagebox",a).addClass("hide");jQuery("#"+g+"_help",a).removeClass("hide");a.find(".fieldValue").val("")})},registerSelectOptionEvent:function(a){jQuery(".useField,.useFunction",a).on("change",function(f){var c=jQuery(f.currentTarget);var d=c.val();var b=a.find(".fieldValue").filter(":visible").val();if(c.hasClass("useField")){if(b!=""){var g=b+" "+d}else{g=d}}else{g=b+d}a.find(".fieldValue").val(g);c.val("").trigger("chosen:updated")})},registerEvents:function(){var a=this.getContainer();var b=app.validationEngineOptions;b.onValidationComplete=function(d,c){return c};b.promptPosition="bottomRight";a.validationEngine(b);this.registerCancelStepClickEvent(a);this.advanceFilterInstance=Vtiger_AdvanceFilter_Js.getInstance(jQuery(".filterContainer",a));this.getPopUp(a);app.changeSelectElementView(a)}});