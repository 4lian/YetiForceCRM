
jQuery.Class("Settings_PDF_ExportPDF_Js",{validateSubmit:function(a){var c=new Array();var b=0;a.find('[name="pdf_template[]"]').each(function(){if(jQuery(this).is(":checked")){c[b]=jQuery(this).val();b++}});if(c.length>0){a.find("#generate_pdf").attr("disabled",false);if(c.length>1||(app.getUrlVar("view")==="List"&&JSON.parse(a.find('[name="validRecords"]').val()).length>0)){a.find("#single_pdf").show()}else{a.find("#single_pdf").hide()}}else{a.find("#generate_pdf").attr("disabled",true);a.find("#single_pdf").hide()}},registerPreSubmitEvent:function(a){a.find("#generate_pdf, #single_pdf").on("click",function(d){var f=new Array();var c=0;a.find('[name="pdf_template[]"]').each(function(){if(jQuery(this).is(":checked")){f[c]=jQuery(this).val();c++}});var b=jQuery(this).data("url");if(app.getUrlVar("view")==="List"){b=b.replace("&record=&","&record="+a.find('[name="validRecords"]').val()+"&")}jQuery(this).prop("href",b+JSON.stringify(f))})},registerValidateSubmit:function(a){var b=this;b.validateSubmit(a);a.find('[name="pdf_template[]"]').on("change",function(){b.validateSubmit(a)})},registerListViewCheckRecords:function(a){var b=this;a.find('[name="pdf_template[]"]').on("change",function(){document.progressLoader=jQuery.progressIndicator({message:app.vtranslate("JS_RECALCULATING"),position:"html",blockInfo:{enabled:true}});var e=a.find('[name="selectedRecords"]').val();var c=[];a.find('[name="pdf_template[]"]:checked').each(function(f){c[f]=jQuery(this).val()});var d={};d.data={parent:"Settings",module:"PDF",action:"ValidateRecords",records:e,view:app.getUrlVar("view"),for_module:app.getUrlVar("module"),templates:c};d.dataType="json";AppConnector.request(d).then(function(g){var f=g.result;if(g.success){a.find('[name="validRecords"]').val(JSON.stringify(f.valid_records));a.find("#recordsInfo").text(f.message);setTimeout(function(){document.progressLoader.progressIndicator({mode:"hide"})},500);b.validateSubmit(a)}},function(g,f){app.errorLog(g,f)})})},countSelectedRecords:function(a){var b=JSON.parse(a.find('[name="selectedRecords"]').val());return b.length},registerEvents:function(){var b=jQuery("div.modal-content");this.registerPreSubmitEvent(b);this.registerValidateSubmit(b);if(app.getUrlVar("view")==="List"){this.registerListViewCheckRecords(b);var a='<input type="hidden" name="selectedRecords" value="" />';b.find("div.modal-footer").prepend(a);var c='<input type="hidden" name="validRecords" value="" />';b.find("div.modal-footer").prepend(c);a=b.find('[name="selectedRecords"]');c=b.find('[name="validRecords"]');b.find("div.modal-header").append('<p id="recordsInfo">records info</p>');var d=[];jQuery(".listViewEntriesCheckBox:checked").each(function(e){d[e]=jQuery(this).val()});a.val(JSON.stringify(d));c.val(JSON.stringify(d));jQuery("#recordsInfo").text(d.length+" from "+d.length+" are valid for chosen template.");b.find('[name="pdf_template[]"]').first().trigger("change")}}});jQuery(function(){var a=new Settings_PDF_ExportPDF_Js();a.registerEvents()});