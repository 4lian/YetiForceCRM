
jQuery.Class("Calendar_ActivityStateModal_Js",{},{registerActivityState:function(){var a=this;jQuery("#activityStateModal button").on("click",function(h){var g=jQuery(h.currentTarget);g.closest(".modal").addClass("hide");if(g.hasClass("showQuickCreate")){var f=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d="Calendar";var c="index.php?module=Calendar&view=QuickCreateAjax&sourceModule=Calendar&sourceRecord="+g.data("id");var b=Vtiger_Header_Js.getInstance();b.getQuickCreateForm(c,d).then(function(e){f.progressIndicator({mode:"hide"});b.handleQuickCreateData(e,{callbackFunction:function(i){if(i&&i.success){a.updateActivityState(g)}}})})}else{a.updateActivityState(g)}})},updateActivityState:function(c){var a=this;var d={module:"Calendar",action:"ActivityStateAjax",id:c.data("id"),state:c.data("state")};app.hideModalWindow();var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(i){if(i.success){var j=app.getViewName();if(j==="Detail"){var h=jQuery(".activityWidgetContainer .widgetContentBlock");var g=Vtiger_Detail_Js.getInstance();if(h.length){g.loadWidget(h)}else{var e=g.getTabByLabel(g.detailViewRecentActivitiesTabLabel);if(e){e.trigger("click")}if(app.getModuleName()=="Calendar"){e=((!g.getSelectedTab().length||g.getSelectedTab().data("linkKey")==g.detailViewDetailsTabLabel)?g.getTabContainer().find('[data-link-key="'+g.detailViewDetailsTabLabel+'"]'):jQuery("<div></div>"));jQuery(".showModal.closeCalendarRekord").addClass("hide");e.trigger("click")}}}if(j=="List"){var f=new Vtiger_List_Js();f.getListViewRecords()}Vtiger_Index_Js.requestReminder();b.progressIndicator({mode:"hide"})}else{return false}})},registerEvents:function(){this.registerActivityState()}});jQuery(document).ready(function(b){var a=new Calendar_ActivityStateModal_Js();a.registerEvents()});